(()=>{"use strict";const n={primary:"#2c5f5f",secondary:"#ff6600",text:"#333333",textLight:"#666666",background:"#ffffff",userMessage:"#e8f4f8",botMessage:"#f5f5f5",shadow:"rgba(0,0,0,0.15)"},t={duration:300,easing:"cubic-bezier(0.4, 0, 0.2, 1)"},e={initial:"Hello! I'm the TechNet assistant. I can help you with information about immunization programs, guidelines, and resources. How can I assist you today?",placeholder:"Type your message here...",error:"Sorry, I'm having trouble connecting right now. Please try again in a moment.",thinking:"Thinking..."},i={windowWidth:380,windowHeight:500,mobileBreakpoint:768};function s(n,t="",e=""){const i=document.createElement(n);return t&&(i.className=t),e&&(i.innerHTML=e),i}function o(n){setTimeout(()=>{n.scrollTop=n.scrollHeight},100)}function a(n){const t=document.createElement("div");return t.textContent=n,t.innerHTML}class r extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.isOpen=!1,this.isMinimized=!1,this.messageHistory=[],this.isTyping=!1,this.typingIndicator=null,this.toggleChat=this.toggleChat.bind(this),this.openChat=this.openChat.bind(this),this.closeChat=this.closeChat.bind(this),this.toggleMinimize=this.toggleMinimize.bind(this),this.sendMessage=this.sendMessage.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleOutsideClick=this.handleOutsideClick.bind(this)}connectedCallback(){this.render(),this.bindEvents(),this.addMessage(e.initial,"bot",[],!0)}render(){const o=s("style");o.textContent=`\n    :host {\n      all: initial; /* Reset all inherited styles */\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    }\n\n    * {\n      box-sizing: border-box;\n      margin: 0;\n      padding: 0;\n    }\n\n    .technet-chatbot * {\n      box-sizing: border-box;\n      margin: 0;\n      padding: 0;\n    }\n\n    .technet-chatbot-trigger {\n      position: fixed;\n      bottom: 24px;\n      right: 24px;\n      width: 60px;\n      height: 60px;\n      background: linear-gradient(135deg, ${n.primary} 0%, #3a7a7a 100%);\n      border-radius: 50%;\n      cursor: pointer;\n      box-shadow: 0 4px 20px ${n.shadow};\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: all ${t.duration}ms ${t.easing};\n      z-index: 10000;\n      border: none;\n      outline: none;\n    }\n\n    .technet-chatbot-trigger:hover {\n      transform: scale(1.05);\n      box-shadow: 0 6px 25px ${n.shadow};\n    }\n\n    .technet-chatbot-trigger:active {\n      transform: scale(0.95);\n    }\n\n    .technet-chatbot-trigger svg {\n      width: 28px;\n      height: 28px;\n      fill: white;\n      transition: transform ${t.duration}ms ${t.easing};\n    }\n\n    .technet-chatbot-trigger.open svg {\n      transform: rotate(180deg);\n    }\n\n    .technet-chatbot-window {\n      position: fixed;\n      bottom: 100px;\n      right: 24px;\n      width: ${i.windowWidth}px;\n      height: ${i.windowHeight}px;\n      background: ${n.background};\n      border-radius: 16px;\n      box-shadow: 0 10px 40px ${n.shadow};\n      display: none;\n      flex-direction: column;\n      z-index: 9999;\n      overflow: hidden;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      animation: slideUp ${t.duration}ms ${t.easing};\n    }\n\n    @keyframes slideUp {\n      from {\n        opacity: 0;\n        transform: translateY(20px);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n\n    .technet-chatbot-header {\n      background: linear-gradient(135deg, ${n.primary} 0%, #3a7a7a 100%);\n      color: white;\n      padding: 16px 20px;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n    }\n\n    .technet-chatbot-title {\n      font-size: 16px;\n      font-weight: 600;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .technet-chatbot-controls {\n      display: flex;\n      gap: 8px;\n    }\n\n    .technet-chatbot-control-btn {\n      background: rgba(255, 255, 255, 0.2);\n      border: none;\n      border-radius: 4px;\n      color: white;\n      cursor: pointer;\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: background ${t.duration}ms ease;\n    }\n\n    .technet-chatbot-control-btn:hover {\n      background: rgba(255, 255, 255, 0.3);\n    }\n\n    .technet-chatbot-messages {\n      flex: 1;\n      overflow-y: auto;\n      padding: 20px;\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n      scroll-behavior: smooth;\n    }\n\n    .technet-chatbot-messages::-webkit-scrollbar {\n      width: 6px;\n    }\n\n    .technet-chatbot-messages::-webkit-scrollbar-track {\n      background: #f1f1f1;\n    }\n\n    .technet-chatbot-messages::-webkit-scrollbar-thumb {\n      background: #c1c1c1;\n      border-radius: 3px;\n    }\n    @keyframes messageSlideIn {\n      from {\n        opacity: 0;\n        transform: translateY(10px);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n      \n    .technet-message {\n      display: flex;\n      align-items: flex-end;\n      gap: 8px;\n      animation: messageSlideIn 0.3s ease-out;\n      margin-bottom: 12px;\n    }\n\n    .technet-message.user {\n      flex-direction: row-reverse;\n    }\n\n    .technet-message-avatar {\n      width: 32px;\n      height: 32px;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 12px;\n      font-weight: bold;\n      flex-shrink: 0;\n    }\n\n    .technet-message.bot .technet-message-avatar {\n      background: ${n.primary};\n      color: white;\n    }\n\n    .technet-message.user .technet-message-avatar {\n      background: ${n.secondary};\n      color: white;\n    }\n\n    /* This is the key fix - proper message content container */\n    .technet-message > div:not(.technet-message-avatar) {\n      display: flex;\n      flex-direction: column;\n      max-width: calc(100% - 48px); /* Account for avatar + gap */\n    }\n\n    .technet-message-content {\n      padding: 12px 16px;\n      border-radius: 18px;\n      font-size: 14px;\n      line-height: 1.4;\n      word-wrap: break-word;\n      overflow-wrap: break-word;\n      hyphens: auto;\n      max-width: 100%;\n      width: fit-content;\n      min-width: 60px;\n    }\n\n    .technet-message.bot .technet-message-content {\n      background: ${n.botMessage};\n      color: ${n.text};\n      border-bottom-left-radius: 6px;\n    }\n\n    .technet-message.user .technet-message-content {\n      background: ${n.userMessage};\n      color: ${n.text};\n      border-bottom-right-radius: 6px;\n      align-self: flex-end; /* This keeps user messages on the right */\n    }\n\n    .technet-message-time {\n      font-size: 11px;\n      color: ${n.textLight};\n      margin-top: 4px;\n    }\n\n    .technet-message.user .technet-message-time {\n      align-self: flex-end;\n    }\n\n    .technet-message.bot .technet-message-time {\n      align-self: flex-start;\n    }\n\n    .technet-message-sources {\n      margin-top: 8px;\n      padding: 8px 12px;\n      background: rgba(44, 95, 95, 0.05);\n      border-radius: 8px;\n      border-left: 3px solid ${n.primary};\n    }\n\n    .technet-sources-title {\n      font-size: 12px;\n      font-weight: 600;\n      color: ${n.primary};\n      margin-bottom: 4px;\n    }\n\n    .technet-sources-list {\n      list-style: none;\n      font-size: 11px;\n    }\n\n    .technet-sources-list li {\n      margin-bottom: 2px;\n    }\n\n    .technet-sources-list a {\n      color: ${n.primary};\n      text-decoration: none;\n      word-break: break-all;\n    }\n\n    .technet-sources-list a:hover {\n      text-decoration: underline;\n    }\n\n    .technet-typing-indicator {\n      display: flex;\n      align-items: center;\n      gap: 4px;\n      color: ${n.textLight};\n      font-size: 12px;\n    }\n\n    .technet-typing-dots {\n      display: flex;\n      gap: 2px;\n    }\n\n    .technet-typing-dot {\n      width: 4px;\n      height: 4px;\n      background: ${n.textLight};\n      border-radius: 50%;\n      animation: typingDot 1.4s infinite ease-in-out;\n    }\n\n    .technet-typing-dot:nth-child(2) {\n      animation-delay: 0.2s;\n    }\n\n    .technet-typing-dot:nth-child(3) {\n      animation-delay: 0.4s;\n    }\n\n    @keyframes typingDot {\n      0%, 60%, 100% {\n        transform: translateY(0);\n        opacity: 0.5;\n      }\n      30% {\n        transform: translateY(-8px);\n        opacity: 1;\n      }\n    }\n\n    .technet-chatbot-input {\n      padding: 16px 20px;\n      border-top: 1px solid #e0e0e0;\n      display: flex;\n      gap: 12px;\n      align-items: flex-end;\n    }\n\n    .technet-input-wrapper {\n      flex: 1;\n      position: relative;\n      display: flex;\n      align-items: flex-end;\n      gap: 8px;\n    }\n\n    .technet-input-field {\n      width: 100%;\n      min-height: 20px;\n      max-height: 80px;\n      padding: 12px 16px;\n      border: 2px solid #e0e0e0;\n      border-radius: 20px;\n      font-size: 14px;\n      font-family: inherit;\n      resize: none;\n      outline: none;\n      transition: border-color 0.2s ease;\n      overflow-y: auto;\n      word-wrap: break-word;\n      overflow-wrap: break-word;\n      white-space: pre-wrap; /* Allow proper line breaks in input */\n      box-sizing: border-box;\n    }\n\n    .technet-input-field:focus {\n      border-color: ${n.primary};\n    }\n\n    .technet-input-field::placeholder {\n      color: ${n.textLight};\n    }\n\n    .technet-send-btn {\n      width: 40px;\n      height: 40px;\n      background: ${n.primary};\n      border: none;\n      border-radius: 50%;\n      color: white;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: all 0.2s ease;\n      flex-shrink: 0;\n    }\n\n    .technet-send-btn:hover:not(:disabled) {\n      background: #3a7a7a;\n      transform: scale(1.05);\n    }\n\n    .technet-send-btn:disabled {\n      background: #ccc;\n      cursor: not-allowed;\n      transform: none;\n    }\n\n    .technet-notification {\n      position: fixed;\n      bottom: 80px;\n      right: 100px;\n      background: ${n.primary};\n      color: white;\n      padding: 8px 12px;\n      border-radius: 20px;\n      font-size: 12px;\n      box-shadow: 0 2px 10px ${n.shadow};\n      animation: notificationSlide 0.3s ease-out;\n      z-index: 10001;\n      max-width: 200px;\n      word-wrap: break-word;\n    }\n\n    @keyframes notificationSlide {\n      from {\n        opacity: 0;\n        transform: translateX(100%);\n      }\n      to {\n        opacity: 1;\n        transform: translateX(0);\n      }\n    }\n\n    /* Mobile Responsiveness */\n    @media (max-width: ${i.mobileBreakpoint}px) {\n      .technet-chatbot-window {\n        width: calc(100vw - 24px);\n        height: calc(100vh - 114px);\n        bottom: 95px;\n        right: 12px;\n        border-radius: 12px;\n      }\n      \n      .technet-chatbot-trigger {\n        bottom: 16px;\n        right: 16px;\n      }\n    }\n\n    /* Minimized state */\n    .technet-chatbot-window.minimized {\n      height: 60px;\n      overflow: hidden;\n    }\n\n    .technet-chatbot-window.minimized .technet-chatbot-messages,\n    .technet-chatbot-window.minimized .technet-chatbot-input {\n      display: none;\n    }\n\n    /* Accessibility */\n    .technet-chatbot-trigger:focus,\n    .technet-chatbot-control-btn:focus,\n    .technet-send-btn:focus {\n      outline: 2px solid ${n.secondary};\n      outline-offset: 2px;\n    }\n  `,this.shadow.appendChild(o);const a=s("div","technet-chatbot");this.trigger=s("button","technet-chatbot-trigger"),this.trigger.innerHTML='\n      <svg viewBox="0 0 24 24">\n        <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>\n      </svg>\n    ',this.trigger.setAttribute("aria-label","Open TechNet Chat Assistant"),this.trigger.setAttribute("role","button"),this.trigger.setAttribute("tabindex","0"),this.window=s("div","technet-chatbot-window"),this.window.setAttribute("role","dialog"),this.window.setAttribute("aria-label","TechNet Chat Assistant");const r=s("div","technet-chatbot-header");r.innerHTML='\n      <div class="technet-chatbot-title">\n        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">\n          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>\n        </svg>\n        TechNet Assistant\n      </div>\n      <div class="technet-chatbot-controls">\n        <button class="technet-chatbot-control-btn minimize-btn" aria-label="Minimize chat">\n          <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24">\n            <path d="M19 13H5v-2h14v2z"/>\n          </svg>\n        </button>\n        <button class="technet-chatbot-control-btn close-btn" aria-label="Close chat">\n          <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24">\n            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n          </svg>\n        </button>\n      </div>\n    ',this.messagesContainer=s("div","technet-chatbot-messages"),this.messagesContainer.setAttribute("role","log"),this.messagesContainer.setAttribute("aria-live","polite");const h=s("div","technet-chatbot-input");h.innerHTML=`\n      <div class="technet-input-wrapper">\n        <textarea class="technet-input-field" placeholder="${e.placeholder}" rows="1" maxlength="1000" aria-label="Message input"></textarea>\n        <button class="technet-send-btn" aria-label="Send message">\n          <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">\n            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>\n          </svg>\n        </button>\n      </div>\n    `,this.window.appendChild(r),this.window.appendChild(this.messagesContainer),this.window.appendChild(h),a.appendChild(this.trigger),a.appendChild(this.window),this.shadow.appendChild(a),this.inputField=this.window.querySelector(".technet-input-field"),this.sendBtn=this.window.querySelector(".technet-send-btn"),this.minimizeBtn=this.window.querySelector(".minimize-btn"),this.closeBtn=this.window.querySelector(".close-btn")}bindEvents(){this.trigger.addEventListener("click",this.toggleChat),this.trigger.addEventListener("keydown",this.handleKeyDown),this.closeBtn.addEventListener("click",this.closeChat),this.minimizeBtn.addEventListener("click",this.toggleMinimize),this.inputField.addEventListener("keydown",n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),this.sendMessage())}),this.inputField.addEventListener("input",()=>{!function(n,t=80){n.style.height="auto",n.style.height=Math.min(n.scrollHeight,t)+"px"}(this.inputField)}),this.sendBtn.addEventListener("click",this.sendMessage),this.shadow.addEventListener("keydown",n=>{"Escape"===n.key&&this.isOpen&&this.closeChat()}),this.shadow.addEventListener("click",this.handleOutsideClick),window.addEventListener("resize",function(n,t){let e;return function(...i){clearTimeout(e),e=setTimeout(()=>{clearTimeout(e),n(...i)},t)}}(()=>{this.isOpen&&window.innerWidth},250))}handleKeyDown(n){"Enter"!==n.key&&" "!==n.key||(n.preventDefault(),this.toggleChat())}handleOutsideClick(n){this.isOpen&&!this.window.contains(n.target)&&this.trigger.contains(n.target)}toggleChat(){this.isOpen?this.closeChat():this.openChat()}openChat(){this.isOpen=!0,this.window.style.display="flex",this.trigger.classList.add("open"),this.trigger.setAttribute("aria-expanded","true"),setTimeout(()=>{this.inputField.focus()},300),o(this.messagesContainer)}closeChat(){this.isOpen=!1,this.isMinimized=!1,this.window.style.display="none",this.window.classList.remove("minimized"),this.trigger.classList.remove("open"),this.trigger.setAttribute("aria-expanded","false")}toggleMinimize(){this.isMinimized=!this.isMinimized,this.isMinimized?(this.window.classList.add("minimized"),this.minimizeBtn.innerHTML='\n        <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24">\n          <path d="M18 9v4H6V9h12m0-2H6c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2z"/>\n        </svg>\n      ',this.minimizeBtn.setAttribute("aria-label","Restore chat")):(this.window.classList.remove("minimized"),this.minimizeBtn.innerHTML='\n        <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24">\n          <path d="M19 13H5v-2h14v2z"/>\n        </svg>\n      ',this.minimizeBtn.setAttribute("aria-label","Minimize chat"),o(this.messagesContainer))}async sendMessage(){const n=this.inputField.value.trim();if(n&&!this.isTyping){this.addMessage(n,"user"),this.inputField.value="",this.inputField.style.height="auto",this.showTypingIndicator();try{const n=await async function(){if(await new Promise(n=>setTimeout(n,1e3+2e3*Math.random())),Math.random()<.1)throw new Error("Network error");const n=[{text:"Based on current WHO guidelines, routine immunization schedules should be maintained even during health emergencies. It's crucial to ensure continued protection against vaccine-preventable diseases.",sources:["https://www.who.int/immunization/policy/position_papers/en/","https://www.cdc.gov/vaccines/schedules/index.html"]},{text:"The global immunization coverage has shown improvement over recent years, with over 85% of children worldwide receiving basic vaccines. However, equity gaps remain in underserved populations.",sources:["https://www.who.int/news-room/fact-sheets/detail/immunization-coverage","https://data.unicef.org/topic/child-health/immunization/"]},{text:"Cold chain management is critical for vaccine effectiveness. Vaccines should be stored between 2-8Â°C and monitored continuously to ensure potency.",sources:["https://www.who.int/immunization/programmes_systems/supply_chain/resources/en/","https://www.cdc.gov/vaccines/hcp/admin/storage/guide.html"]}];return n[Math.floor(Math.random()*n.length)]}();this.hideTypingIndicator(),this.addMessage(n.text,"bot",n.sources)}catch(n){console.error("Chatbot API Error:",n),this.hideTypingIndicator(),this.addMessage(e.error,"bot"),this.showNotification("Connection error. Please try again.")}}}addMessage(n,t,e=[],i=!1){const s={id:Date.now().toString(36)+Math.random().toString(36).substr(2),text:a(n),sender:t,sources:e||[],timestamp:new Date,isInitial:i};this.messageHistory.push(s);const r=this.createMessageElement(s);this.messagesContainer.appendChild(r),i||o(this.messagesContainer)}createMessageElement(n){const t=s("div",`technet-message ${n.sender}`);t.setAttribute("data-message-id",n.id);const e=s("div","technet-message-avatar");e.textContent="bot"===n.sender?"TN":"U";const i=s("div"),o=s("div","technet-message-content");o.textContent=n.text;const a=s("div","technet-message-time");if(a.textContent=n.timestamp.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),i.appendChild(o),i.appendChild(a),n.sources&&n.sources.length>0){const t=s("div","technet-message-sources"),e=s("ul","technet-sources-list");if(n.sources.forEach(n=>{const t=function(n){try{const t=new URL(n);return"http:"===t.protocol||"https:"===t.protocol?n:""}catch(n){return""}}(n);if(t){const n=s("li"),i=s("a");i.href=t,i.target="_blank",i.rel="noopener noreferrer",i.textContent=t,n.appendChild(i),e.appendChild(n)}}),e.children.length>0){const n=s("div","technet-sources-title");n.textContent="Sources:",t.appendChild(n),t.appendChild(e),i.appendChild(t)}}return t.appendChild(e),t.appendChild(i),t}showTypingIndicator(){this.typingIndicator||(this.isTyping=!0,this.sendBtn.disabled=!0,this.typingIndicator=s("div","technet-message bot"),this.typingIndicator.innerHTML=`\n      <div class="technet-message-avatar">TN</div>\n      <div class="technet-message-content">\n        <div class="technet-typing-indicator">\n          <span>${e.thinking}</span>\n          <div class="technet-typing-dots">\n            <div class="technet-typing-dot"></div>\n            <div class="technet-typing-dot"></div>\n            <div class="technet-typing-dot"></div>\n          </div>\n        </div>\n      </div>\n    `,this.messagesContainer.appendChild(this.typingIndicator),o(this.messagesContainer))}hideTypingIndicator(){this.typingIndicator&&(this.typingIndicator.remove(),this.typingIndicator=null),this.isTyping=!1,this.sendBtn.disabled=!1}showNotification(n){const t=s("div","technet-notification");t.textContent=a(n),this.shadow.appendChild(t),setTimeout(()=>{t.parentNode&&t.remove()},3e3)}}customElements.define("technet-chatbot",r),window.technetChatbotInitialized||(window.technetChatbotInitialized=!0,function(){if("loading"===document.readyState)document.addEventListener("DOMContentLoaded",()=>{const n=document.createElement("technet-chatbot");document.body.appendChild(n)});else{const n=document.createElement("technet-chatbot");document.body.appendChild(n)}}())})();